plugins {
    id "idea"
}

/**
 * é¡¹ç›®åˆå§‹åŒ–ä»»åŠ¡
 * - æ¸…ç©ºå·²å­˜åœ¨çš„æ•°æ®åº“
 * - å»ºåº“å»ºè¡¨è¿ç§»æ•°æ®
 * - è‡ªåŠ¨å®‰è£…å‰ç«¯ä¾èµ–
 */
task setup(type: GradleBuild) {
    group = 'project'
    description = 'Setup project'
    doFirst {
        println 'Start setup project'
        println 'Project name:' + project.name
        println 'Group name:' + project.group
        println 'Version:' + project.version
        println 'â˜•ï¸ Start reset, migrate database and install node dependencies, please wait...'
    }

    tasks = [':frontend:install']

    doLast {
        println 'ğŸ‰ Project setup complete! Enjoy coding! ğŸ¤©'
    }
}

/**
 * é¡¹ç›®å…¨é‡æ„å»º & è¿è¡Œä»»åŠ¡
 * - æ„å»ºå‰ç«¯ & åç«¯
 * - æ›´æ–°æ•°æ®åº“æ•°æ®
 * - æ•´åˆå‰åç«¯ä»£ç 
 * - è¿è¡Œé¡¹ç›®
 */
task run(type: GradleBuild) {
    group = 'project'
    description = 'Run project with both frontend and backend'
    tasks = [':frontend:generateStatic', ':backend:quarkusDev']

    doFirst {
        def nodeDependencies = new File(project(':frontend').projectDir, 'node_modules')
        if (!nodeDependencies.exists()) {
            // å¦‚æœæ²¡æœ‰åˆå§‹åŒ–é¡¹ç›®è€Œæ˜¯ç›´æ¥ç‚¹äº†è¿è¡Œï¼Œåˆ™éœ€è¦å…ˆå®‰è£…ä¾èµ–
            println 'ğŸ›  Node dependencies not found, install first...'
            tasks = [':frontend:install', *tasks]
        }
    }
}

/**
 * å¯åŠ¨å‰ç«¯å¼€å‘æœåŠ¡
 */
task frontendDev(type: GradleBuild) {
    group = 'project'
    description = 'Start frontend Vue development server'
    tasks = [':frontend:serve']
}

/**
 * å¯åŠ¨å‰ç«¯åŸç”Ÿå¼€å‘æœåŠ¡
 */
task frontendNativeDev(type: GradleBuild) {
    group = 'project'
    description = 'Start frontend Vue development server'
    tasks = [':frontend:nativeServe']
}

/**
 * å¯åŠ¨åç«¯å¼€å‘æœåŠ¡
 */
task backendDev(type: GradleBuild) {
    group = 'project'
    description = 'Start backend Quarkus development server'
    tasks = [':backend:quarkusDev']
}
