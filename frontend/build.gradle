plugins {
    id 'com.github.node-gradle.node' version '3.1.1'
}

/**
 * å®‰è£…å‰ç«¯é¡¹ç›®ä¾èµ–
 */
task install(type: YarnTask) {
    group = 'yarn'
    description = 'Install dependencies'
    args = ['install']

    doFirst {
        exec {
            executable 'npm'
            args 'install', 'yarn', '--global'
        }
    }
}

/**
 * å¯åŠ¨å‰ç«¯å¼€å‘æœåŠ¡å™¨
 */
task serve(type: YarnTask) {
    group = 'vue'
    description = 'Runs the Vue.js development server'
    args = ['serve']

    doFirst {
        println 'ğŸ—‘ Cleaning up springboot static files for accessing the vue server only...'
        delete project(':backend').file('src/main/resources/META-INF/resources')
        println 'ğŸ›  Starting vue development server...'
    }
}

task nativeServe(type: YarnTask) {
    group = 'vue'
    description = 'Runs the Vue.js x Tauri development server'
    args = ['tauri:serve']

    doFirst {
        println 'ğŸ—‘ Cleaning up springboot static files for accessing the vue server only...'
        delete project(':backend').file('src/main/resources/META-INF/resources')
        println 'ğŸ›  Starting vue development server...'
    }
}

/**
 * æ„å»ºå‰ç«¯é¡¹ç›®å¹¶ç§»åŠ¨åˆ° Springboot é™æ€èµ„æºæ–‡ä»¶å¤¹ä¸­
 * - æ­¤æ—¶æ›´æ”¹å‰ç«¯ä»£ç éœ€è¦é‡æ–°æ‰§è¡Œè¯¥æ­¥éª¤æ„å»º
 * - å»ºè®®åœ¨å¼€å‘è¿‡ç¨‹ä¸­ä½¿ç”¨ä¸Šé¢çš„å¼€å‘æœåŠ¡å™¨æ¨¡å¼
 */
task generateStatic(type: YarnTask) {
    group = 'integration'
    description = 'Build static files, then move them to springboot static folder'
    args = ['build']

    doFirst {
        println 'ğŸ›  Generating static files...'
    }

    doLast {
        println 'ğŸ§± Copying static files to springboot static folder...'
        def staticDir = new File(projectDir, 'dist')
        def springbootStaticDir = new File(project(':backend').projectDir, 'src/main/resources/META-INF/resources')
        if (!staticDir.exists()) {
            staticDir.mkdirs()
        } else {
            staticDir.delete()
            staticDir.mkdirs()
        }

        copy {
            from staticDir
            into springbootStaticDir
        }
        println 'âœ… Static files copied to springboot static folder!'
    }
}
